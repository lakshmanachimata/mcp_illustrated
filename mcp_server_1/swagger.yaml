openapi: 3.0.3
info:
  title: MCP Server - Local DB
  description: 'MCP server exposing database tools: create/alter/drop tables (with
    fields), CRUD records, list tables, get table schema, add survey questions, execute
    natural-language instructions. Connect via MCP protocol (streamable-http at /mcp).'
  version: 1.1.0
servers:
- url: http://localhost:8001/mcp
  description: MCP Server (default port 8001)
paths:
  /tools/create_record:
    post:
      summary: create_record
      description: 'Create a new record in the given table. data is a JSON object
        of fields (e.g. {"name": "Alice", "email": "alice@example.com"}).'
      operationId: create_record
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
              - table_name
              - data
              properties:
                table_name:
                  type: string
                  description: Table name
                data:
                  type: object
                  additionalProperties: true
                  description: Record fields as JSON object
      responses:
        '200':
          description: Created record with id, table_name, data, created_at, updated_at
  /tools/get_record:
    post:
      summary: get_record
      description: Get a single record by table name and id. Returns null if not found.
      operationId: get_record
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
              - table_name
              - record_id
              properties:
                table_name:
                  type: string
                record_id:
                  type: integer
      responses:
        '200':
          description: Record or null
  /tools/list_records:
    post:
      summary: list_records
      description: List records in a table, newest first.
      operationId: list_records
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                table_name:
                  type: string
                limit:
                  type: integer
                  default: 100
      responses:
        '200':
          description: List of records
  /tools/find_records_by_field:
    post:
      summary: find_records_by_field
      description: 'Find records where a field equals a value (e.g. find user by name:
        table_name=''users'', field_name=''name'', field_value=''lakshmana''). Returns
        list of full records.'
      operationId: find_records_by_field
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
              - table_name
              - field_name
              - field_value
              properties:
                table_name:
                  type: string
                field_name:
                  type: string
                field_value:
                  description: Value to match (string, number, or boolean)
      responses:
        '200':
          description: List of matching records
  /tools/find_update_and_get_record:
    post:
      summary: find_update_and_get_record
      description: 'Find one record by field value, update it with given data, and
        return the updated record (e.g. table_name=''users'', field_name=''name'',
        field_value=''lakshmana'', update_data={''status'': ''inactive''}).'
      operationId: find_update_and_get_record
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
              - table_name
              - field_name
              - field_value
              - update_data
              properties:
                table_name:
                  type: string
                field_name:
                  type: string
                field_value:
                  description: Value to match
                update_data:
                  type: object
                  additionalProperties: true
                  description: Fields to merge into the record
      responses:
        '200':
          description: Updated record or null if no match
  /tools/update_record:
    post:
      summary: update_record
      description: Update an existing record. data is merged with existing fields.
      operationId: update_record
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
              - table_name
              - record_id
              - data
              properties:
                table_name:
                  type: string
                record_id:
                  type: integer
                data:
                  type: object
                  additionalProperties: true
      responses:
        '200':
          description: Updated record or null
  /tools/delete_record:
    post:
      summary: delete_record
      description: Delete a record by table name and id.
      operationId: delete_record
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
              - table_name
              - record_id
              properties:
                table_name:
                  type: string
                record_id:
                  type: integer
      responses:
        '200':
          description: Object with deleted, table_name, record_id
  /tools/list_tables:
    post:
      summary: list_tables
      description: List all table names that have at least one record.
      operationId: list_tables
      requestBody:
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Array of table name strings
  /tools/execute_instruction:
    post:
      summary: execute_instruction
      description: 'Execute a database operation from a short natural-language instruction
        (e.g. ''add a record in users with name: John'', ''list all from items'',
        ''delete record 5 from users'', ''create table X with fields a, b'').'
      operationId: execute_instruction
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
              - instruction
              properties:
                instruction:
                  type: string
                  description: Natural language instruction
      responses:
        '200':
          description: Object with success, action, result or error
  /tools/create_table:
    post:
      summary: create_table
      description: Create a new table with the given fields. fields can be comma-separated
        string (e.g. 'name, email, age'), list of names, or list of {name, type}.
        Types default to text.
      operationId: create_table
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
              - table_name
              - fields
              properties:
                table_name:
                  type: string
                  description: Table name
                fields:
                  description: Comma-separated field names, or array of names, or
                    array of {name, type}
      responses:
        '200':
          description: Object with success, table_name, fields, created_at
  /tools/alter_table:
    post:
      summary: alter_table
      description: 'Alter a table''s schema: replace with the new list of fields (e.g.
        ''name, email, phone'' to add phone).'
      operationId: alter_table
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
              - table_name
              - fields
              properties:
                table_name:
                  type: string
                fields:
                  description: 'New field list: comma-separated string or array'
      responses:
        '200':
          description: Object with success, table_name, fields, updated_at
  /tools/drop_table:
    post:
      summary: drop_table
      description: 'Drop a table: remove its schema and delete all records in that
        table.'
      operationId: drop_table
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
              - table_name
              properties:
                table_name:
                  type: string
      responses:
        '200':
          description: Object with success, table_name, records_deleted, dropped
  /tools/get_table_schema:
    post:
      summary: get_table_schema
      description: Get the schema (field names and types) for a table. Returns null
        if table has no defined schema.
      operationId: get_table_schema
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
              - table_name
              properties:
                table_name:
                  type: string
      responses:
        '200':
          description: Object with table_name, fields (array of {name, type}) or null
  /tools/add_survey_questions:
    post:
      summary: add_survey_questions
      description: Add one or more survey questions to the database. Pass questions
        as newline-separated or numbered list.
      operationId: add_survey_questions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
              - questions_text
              properties:
                questions_text:
                  type: string
                  description: Newline or numbered list of questions
      responses:
        '200':
          description: Object with success, created, records
